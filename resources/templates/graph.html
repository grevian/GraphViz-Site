   {% extends "base.html" %}
   {% block content %}
    <h2>Make A Graph</h2>
        <p>Enter your <code class="inline">DOT</code> definition in the box below, and click Generate to display the resulting graph.</p>
        <form method="POST" action="/graph" id="dot-submission">
         <textarea spellcheck="false" wrap="off" id="dot" name="dot">{{ dot|e }}</textarea>
         <br />
         <label for="method">Layout Method</label>
         <select id="method" name="method">
          <option value="dot" {% if method == 'dot' %}selected{% endif %}>dot</option>
          <option value="neato" {% if method == 'neato' %}selected{% endif %}>neato</option>
          <option value="twopi" {% if method == 'twopi' %}selected{% endif %}>twopi</option>
          <option value="circo" {% if method == 'circo' %}selected{% endif %}>circo</option>
          <option value="fdp" {% if method == 'fdp' %}selected{% endif %}>fdp</option>
          <option value="sfdp" {% if method == 'sfdp' %}selected{% endif %}>sfdp</option>
         </select> (Just use trial and error to find the method you think works best)
         <br />
         <input type="submit" value="Generate" />
        </form>
        {% if graph_id %}
        <h2>Results</h2>
        <div id="results">        
        {% if building %}
          <img id="graph-image" src="" />
        {% else %}
          <img id="graph-image" src="/graph/images/{{ graph_id }}" />
        {% endif %}
        <p class="error" id="error-container">
           <h3>Error:</h3>
           <span id="error-message">
            {{ error|e }}
           </span>
        </p>
        {% endif %}
   {% endblock %}

{% if building %}
  {% block javascript %}
           <script>
           var pollPath = '/poll/{{ graph_id }}';

           function pollComplete(data) {
            console.log(data);
            // If still building, wait 5 seconds then try again
            if (data.building == true) {
              console.log("Still Building, Polling Again");
              $.get(pollPath, function(data) { setTimeout(pollComplete(data), 3000); });
            }
            // If completed, Display the imaage
            if (data.building == false) {
              console.log("Build Complete, Loading Image");
              $('#graph-image').attr('src', '/graph/images/{{ graph_id }}');
              $('#graph-image').show();
            }
            // If Errored, explode.
            if (data.error != '') {
              console.log("Error Encountered while building image");
              doFail(data);
            }
           }

           function doFail(data) {
            $('#error-container').show();
            $('#error-message').text(data.error);
           }

           $('#graph-image').hide();
           $('#error-container').hide();

           $.get(pollPath, function( data ){
            pollComplete(data);
           }, "json");
           </script>
  {% endblock %}
{% endif %}
   
 
